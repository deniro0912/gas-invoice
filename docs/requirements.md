# 請求書発行システム要件定義書

## 1. プロジェクト概要

### 1.1 システム名
GAS請求書発行システム

### 1.2 目的
現在のExcel手入力→PDF出力の手作業を自動化し、効率的な請求書発行業務を実現する

### 1.3 利用者
- **Phase 1**: 個人利用（1名）
- **Phase 2**: 社内利用（最大10名程度）

### 1.4 処理規模
月間最大100件の請求書発行

## 2. 現状の課題

### 2.1 現行業務フロー
1. Excelフォーマットに手入力
2. PDF出力
3. ファイル管理

### 2.2 解決すべき課題
- 手入力による時間コスト
- 入力ミスのリスク
- 請求履歴の管理困難
- 顧客情報の重複入力

## 3. 機能要件

### 3.1 Phase 1: MVP（必須機能）

#### 3.1.1 マスタ管理機能
- **顧客情報管理**
  - 顧客情報の登録・編集・削除
  - 顧客一覧表示・検索
  - 必須項目: 顧客ID、会社名、担当者名、住所、メールアドレス、電話番号

#### 3.1.2 請求書作成機能
- 顧客選択（ドロップダウン）
- 請求書情報入力
  - 広告主名（自由入力）
  - 件名（自由入力）
- 請求明細入力
  - 品目名：「制作費」固定
  - 数量：「1」固定
  - 単位：「式」固定
  - 単価：金額入力
  - 税率：「10%」固定
- 自動計算（小計、税額、合計）
- 請求書番号自動採番
- 発行日設定

#### 3.1.3 PDF生成機能
- 既存PDFテンプレートへのデータ埋め込み
- Google Driveへの自動保存
- ファイル命名規則: `請求書_[請求書番号]_[顧客名]_[発行日].pdf`
- PDFテンプレートの管理（Google Driveから読み込み）

#### 3.1.4 請求履歴管理
- 発行済み請求書一覧
- 検索・フィルター機能（期間、顧客、金額範囲）
- 請求書の再発行
- ステータス管理（発行済み、キャンセル）

### 3.2 Phase 2: 拡張機能（将来実装）

#### 3.2.1 見積書機能
- 見積書作成
- 見積書→請求書変換
- 見積書履歴管理

#### 3.2.2 権限管理（社内利用時）
- ユーザー管理
- 役割ベースのアクセス制御

## 4. 非機能要件

### 4.1 性能要件
- 請求書1件の生成時間: 10秒以内
- 月間100件の処理に対応
- 同時利用者数: Phase1は1名、Phase2は最大10名

### 4.2 セキュリティ要件
- Google認証による アクセス制御
- Script Propertiesによる設定管理
- 顧客情報の適切な保護

### 4.3 可用性要件
- Google Apps Scriptの可用性に準拠
- 定期的なバックアップ（Google Drive自動保存）

### 4.4 保守性要件
- TypeScriptによる型安全な実装
- 環境分離（開発/本番）
- ログ出力機能

## 5. システム構成

### 5.1 技術スタック
- **基盤**: Google Apps Script
- **言語**: TypeScript
- **データストア**: Google Spreadsheet
- **ファイルストレージ**: Google Drive
- **ビルドツール**: ESBuild
- **デプロイツール**: clasp

### 5.2 データ構造

#### 5.2.1 スプレッドシート構成
```
請求書管理システム.xlsx
├── 顧客マスタ
│   ├── 顧客ID (自動採番)
│   ├── 会社名
│   ├── 担当者名
│   ├── 郵便番号
│   ├── 住所
│   ├── メールアドレス
│   ├── 電話番号
│   ├── 登録日
│   └── 更新日
│
├── 請求書ヘッダ
│   ├── 請求書番号
│   ├── 発行日
│   ├── 顧客ID
│   ├── 広告主
│   ├── 件名
│   ├── 小計
│   ├── 税額
│   ├── 合計金額
│   ├── 備考
│   ├── ステータス
│   └── PDF URL
│
└── 請求書明細
    ├── 明細ID
    ├── 請求書番号
    ├── 品目名（「制作費」固定）
    ├── 数量（「1」固定）
    ├── 単位（「式」固定）
    ├── 単価
    ├── 税率（「10%」固定）
    └── 金額
```

### 5.3 画面構成

#### 5.3.1 メニュー構成
```
請求書管理システム
├── 請求書作成
├── 請求書一覧
├── 顧客管理
└── 設定
```

#### 5.3.2 請求書作成フロー
1. メニューから「請求書作成」選択
2. 顧客選択ダイアログ表示
3. 請求書情報入力
   - 広告主名入力（自由入力）
   - 件名入力（自由入力）
4. 制作費入力
   - 制作費金額入力（単価）
5. 確認画面
   - 請求内容確認
   - 備考入力
6. PDF生成・保存完了通知

## 6. 開発計画

### 6.1 Phase 1: MVP開発（3週間）

#### Week 1: 基盤構築
- [ ] プロジェクトセットアップ
- [ ] データ構造（スプレッドシート）作成
- [ ] 顧客管理機能実装
  - [ ] 顧客CRUD
  - [ ] 顧客一覧・検索

#### Week 2: 請求書作成機能
- [ ] 請求書作成UI実装
  - [ ] 顧客選択
  - [ ] 広告主・件名入力
  - [ ] 制作費金額入力
  - [ ] 自動計算（消費税10%）
- [ ] PDF生成機能
  - [ ] テンプレート作成
  - [ ] データ埋め込み処理

#### Week 3: 管理機能・仕上げ
- [ ] 請求履歴管理
  - [ ] 一覧表示
  - [ ] 検索機能
- [ ] テスト・バグ修正
- [ ] ドキュメント整備

### 6.2 Phase 2: 拡張機能（時期未定）
- 見積書機能
- 見積書→請求書変換
- 権限管理（社内展開時）

## 7. 制約事項

### 7.1 技術的制約
- Google Apps Scriptの実行時間制限（6分）
- スプレッドシートの行数制限（500万セル）
- Google DriveのAPI制限

### 7.2 機能的制約
- UIはGoogle Apps ScriptのHTMLサービスに制限
- リアルタイム処理は非対応
- オフライン利用不可

## 8. 用語定義

| 用語 | 説明 |
|------|------|
| 請求書番号 | システムが自動採番する一意の識別番号 |
| 顧客ID | 顧客を一意に識別する番号 |
| 商品ID | 商品・サービスを一意に識別する番号 |
| ステータス | 請求書の状態（発行済み、キャンセル） |

## 9. 備考

### 9.1 将来的な拡張可能性
- 入金管理機能
- メール送信機能
- 会計システム連携
- インボイス制度対応

### 9.2 移行計画
既存のExcelデータからの移行ツールを別途検討

---

**文書情報**
- 作成日: 2025年9月13日
- バージョン: 1.0
- 作成者: GAS請求書システム開発チーム
- 最終更新: 2025年9月13日