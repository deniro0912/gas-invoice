# PDF生成機能テストガイド

## テスト結果サマリー 🎉

**実行日時**: 2025年9月14日  
**テスト結果**: 7/7 成功 (100%)

### ✅ 検証済み項目

1. **HTMLテンプレート検証** - 正常
   - 全必須プレースホルダー存在確認
   - CSSスタイル定義確認
   - ファイルサイズ: 約8KB

2. **PDF生成サービス検証** - 正常
   - 7つの必須メソッド実装確認
   - シングルトンパターン実装確認

3. **Google Docs生成サービス検証** - 正常
   - Google Docs API使用確認
   - テンプレート管理機能確認

4. **PDF UI検証** - 正常
   - 2つのダイアログ実装確認
   - イベントハンドラー実装確認

5. **メイン関数統合検証** - 正常
   - 9つのPDF関数エクスポート確認
   - メニュー統合確認

6. **ビルド出力検証** - 正常
   - ビルドサイズ: 222.5KB
   - export文除去確認

7. **設定管理統合検証** - 正常
   - 会社情報メソッド実装確認
   - 銀行情報メソッド実装確認

## GASでのテスト手順

### 1. デプロイ
```bash
# 開発環境へデプロイ
npm run push:dev

# または本番環境へ
npm run push:prod
```

### 2. GASエディタでの実行テスト

#### A. 基本テスト関数実行
1. GASエディタを開く
2. 関数選択ドロップダウンから `testPDFGeneration` を選択
3. 実行ボタン（▶️）をクリック
4. 初回実行時は権限承認が必要

期待される結果：
- テスト請求書の取得成功
- HTMLプレビュー生成成功
- Google Docs経由のPDF生成（またはHTML方式での代替生成）

#### B. UIテスト
1. スプレッドシートを開く
2. メニューから「GAS請求書管理システム」→「PDF生成」→「PDF生成」を選択
3. ダイアログが表示される

テスト項目：
- [ ] 請求書リストが表示される
- [ ] 請求書選択で詳細が表示される
- [ ] プレビューボタンでプレビュー表示
- [ ] PDF生成ボタンでPDF作成
- [ ] Google Driveに保存される

### 3. 生成されたPDFの確認

#### 確認場所
- Google Drive → 「請求書_2025」フォルダ
- ファイル名形式: `請求書_YYYYMM-XXX_会社名.pdf`

#### 確認項目
- [ ] レイアウトが正しい
- [ ] 日本語が正しく表示される
- [ ] 金額計算が正確
- [ ] 会社情報が表示される
- [ ] 顧客情報が表示される

### 4. 一括PDF生成テスト

1. メニューから「PDF生成」→「一括PDF生成」を選択
2. 複数の請求書を選択
3. 「一括生成開始」をクリック

期待される結果：
- 選択した請求書数分のPDFが生成される
- 処理完了メッセージが表示される

## トラブルシューティング

### エラー: "Invalid grant"
```bash
clasp login
```
で再認証

### エラー: "関数が見つかりません"
```bash
npm run build
npm run push:dev
```
でビルドとデプロイを再実行

### エラー: "Google Docs テンプレートが見つかりません"
1. メニュー → PDF生成 → PDFテンプレート設定
2. Google DocsのIDを入力（任意）
3. または自動でテンプレートが作成される

### エラー: "請求書が見つかりません"
1. 先に請求書を作成
2. メニュー → 請求書管理 → 請求書作成

## 環境変数設定

Google Apps Script のスクリプトプロパティで設定：

```javascript
// 会社情報
COMPANY_NAME: 株式会社サンプル
COMPANY_POSTAL_CODE: 100-0001
COMPANY_ADDRESS: 東京都千代田区千代田1-1
COMPANY_PHONE: 03-1234-5678
COMPANY_EMAIL: info@example.com
COMPANY_WEBSITE: https://example.com

// 銀行情報
BANK_DETAILS: みずほ銀行 東京支店 普通 1234567 カ)サンプル

// PDFテンプレート（任意）
INVOICE_TEMPLATE_DOC_ID: [Google DocsのID]
```

## パフォーマンス目安

- 単一PDF生成: 3-5秒
- 一括PDF生成（10件）: 30-40秒
- プレビュー表示: 1-2秒

## セキュリティ考慮事項

- PDFは「リンクを知っている人」に共有される
- メール送信時はSSL/TLS暗号化
- 顧客情報は暗号化されないため注意

## 次の改善点

1. **PDF品質向上**
   - フォント埋め込み
   - ベクターグラフィックス対応
   - カスタムロゴ対応

2. **パフォーマンス最適化**
   - 並列処理の実装
   - キャッシュ機能の追加

3. **機能拡張**
   - 電子署名対応
   - QRコード生成
   - 多言語対応

## まとめ

PDF生成機能は正常に実装され、全てのローカルテストに合格しました。
GASへのデプロイ後、上記の手順でテストを実行してください。