# PDFテンプレート作成ガイド

## 概要

請求書システムでは、既存のPDFテンプレートにデータを埋め込んで請求書を生成します。このガイドでは、PDFテンプレートの作成方法と設定手順を説明します。

## PDFテンプレートの作成

### 1. デザインソフトウェアでの作成

Adobe Acrobat、InDesign、Illustrator等でPDFテンプレートを作成します。

#### 基本レイアウト
```
┌─────────────────────────────────────────┐
│                請求書                    │
│                                         │
│ 請求書番号: [_________________]          │
│ 発行日: [_______________]                │
│                                         │
│ [顧客会社名]_____________________        │
│ [顧客住所]_______________________        │
│                                         │
│ 広告主: [_______________]                │
│ 件名: [_________________________]       │
│                                         │
│ ┌────────────────────────────────────┐ │
│ │品目      │数量│単位│単価   │金額  │ │
│ ├─────────┼───┼───┼──────┼─────┤ │
│ │[_______]│[_]│[_]│[____]│[___]│ │
│ └────────────────────────────────────┘ │
│                                         │
│ 小計: [__________]                      │
│ 消費税(10%): [__________]               │
│ 合計金額: [__________]                  │
│                                         │
│ [発行者情報]                            │
└─────────────────────────────────────────┘
```

### 2. フォームフィールドの設定

Adobe Acrobat Proを使用してフォームフィールドを追加します。

#### フィールド名規則

| フィールド名        | 説明           | 例           |
|------------------- |---------------|-------------|
| invoice_number     | 請求書番号     | 202501-001  |
| issue_date         | 発行日         | 2025年1月1日|
| customer_company   | 顧客会社名     | ○○株式会社 御中 |
| customer_address   | 顧客住所       | 東京都...   |
| advertiser         | 広告主         | △△会社     |
| subject            | 件名           | 広告制作業務 |
| item_name          | 品目名         | 制作費      |
| item_quantity      | 数量           | 1          |
| item_unit          | 単位           | 式         |
| item_price         | 単価           | 100,000    |
| item_amount        | 金額           | 100,000    |
| subtotal           | 小計           | 100,000    |
| tax_amount         | 消費税額       | 10,000     |
| total_amount       | 合計金額       | 110,000    |

### 3. フィールド設定の詳細

#### テキストフィールドの設定
- **フォント**: ヒラギノ角ゴ Pro または MS Pゴシック
- **サイズ**: 10-12pt
- **アライメント**: 左揃え（金額は右揃え）
- **読み取り専用**: チェック（システムから埋め込むため）

#### 数値フィールドの設定
- **フォーマット**: 数値（カンマ区切り）
- **小数点**: 0桁
- **通貨記号**: ¥（必要に応じて）

## ファイル配置

### Google Driveの構造
```
Google Drive
├── 請求書テンプレート/
│   ├── invoice_template.pdf     (メインテンプレート)
│   ├── invoice_template.html    (HTMLテンプレート・オプション)
│   └── template_backup/         (バックアップ)
│
└── 請求書/                     (生成されたPDF保存先)
    ├── 2025/
    │   ├── 01/
    │   ├── 02/
    │   └── ...
    └── 2024/
```

### アップロード手順

1. **フォルダ作成**
   - Google Driveに「請求書テンプレート」フォルダを作成

2. **PDFアップロード**
   - 作成したPDFテンプレートを「invoice_template.pdf」としてアップロード

3. **権限設定**
   - GASが読み取り可能な権限を設定

## テンプレート更新フロー

### 1. デザイン変更時

1. デザインソフトでPDFを修正
2. フォームフィールド名は変更しない
3. 新しいバージョンをGoogle Driveにアップロード
4. 既存ファイルを置き換え

### 2. フィールド追加時

1. 新しいフィールドを追加
2. フィールド名をシステム仕様に合わせる
3. システム側のコードも更新が必要
4. テスト実行で動作確認

## Google Apps Script での対応

### PDFフォーム操作の制限

Google Apps Scriptでは直接的なPDFフォーム操作に制限があるため、以下のアプローチを使用：

#### 方法1: HTMLテンプレート変換
```typescript
// HTMLテンプレートにデータ埋め込み → PDF変換
const htmlContent = this.createHTMLFromTemplate(invoice);
const pdfBlob = this.convertHTMLtoPDF(htmlContent);
```

#### 方法2: Google Docs経由
```typescript
// Google Docsに埋め込み → PDF出力
const doc = DocumentApp.create('temp_invoice');
const pdfBlob = doc.getBlob();
```

### 実装上の注意点

1. **フォント対応**
   - 日本語フォントの確実な表示
   - ブラウザ依存を避ける

2. **レイアウト保持**
   - PDFのレイアウトを正確に再現
   - 改ページの制御

3. **エラーハンドリング**
   - テンプレートファイルが見つからない場合
   - 変換エラーの対処

## テスト手順

### 1. テンプレート確認
- [ ] フォームフィールドが正しく設定されている
- [ ] フィールド名が仕様通り
- [ ] デザインが適切

### 2. システム統合テスト
- [ ] テンプレートが正しく読み込まれる
- [ ] データが正しく埋め込まれる
- [ ] PDFが正常に生成される
- [ ] ファイルが指定フォルダに保存される

### 3. 品質確認
- [ ] 文字化けがない
- [ ] レイアウトが崩れていない
- [ ] 数値フォーマットが正しい
- [ ] 印刷時の見栄えが良い

## トラブルシューティング

### よくある問題

#### 1. テンプレートが読み込めない
**症状**: "テンプレートファイルが見つかりません"エラー
**対処**: 
- ファイル名の確認（invoice_template.pdf）
- フォルダ名の確認（請求書テンプレート）
- GASの権限確認

#### 2. フィールドにデータが入らない
**症状**: PDFにデータが表示されない
**対処**:
- フィールド名の確認
- フォームフィールドの設定確認
- データ型の確認

#### 3. レイアウトが崩れる
**症状**: PDF出力時にレイアウトが崩れる
**対処**:
- HTMLテンプレートのCSS調整
- フォントサイズの調整
- 改ページ設定の見直し

## バージョン管理

### ファイル名規則
```
請求書テンプレート/
├── invoice_template.pdf        (現在使用中)
├── archive/
│   ├── invoice_template_v1.0.pdf
│   ├── invoice_template_v1.1.pdf
│   └── invoice_template_v2.0.pdf
```

### 変更履歴管理
```markdown
# 変更履歴

## v2.0 (2025-01-15)
- 広告主フィールドを追加
- 件名フィールドを追加
- デザインを刷新

## v1.1 (2025-01-10)
- フォントサイズを調整
- 罫線の太さを修正

## v1.0 (2025-01-01)
- 初期バージョン
```

---

**文書情報**
- 作成日: 2025年9月13日
- バージョン: 1.0
- 作成者: GAS請求書システム開発チーム
- 最終更新: 2025年9月13日